(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.KeyboardEngine=a())}(this,(function(){var Q={create:function(ao){var am={};var al=new Array();var an=0;am.next=function(ap){if(an<=al.length){return(al[(an++)])(am,ap)}else{return ao}};am.process=function(aq){var ap=am.next(aq);an=0;return ap};am.reg=function(ap){al.push(ap);return am};return am}};var P={create:function(){var al={};var am=new Array();al.process=function(ap,ao){var an=ap;am.forEach(function(aq){an=aq(an,ao)});return an};al.reg=function(an){am.push(an);return al};return al}};var L={_mcached:{},reg:function(ap,ao,an){if(an!==undefined&&an.constructor===Array){var am=this._mcached;an.forEach(function(aq){am[(ao+":"+aq)]=ap})}else{var al=(an===undefined?0:an);this._mcached[(ao+":"+al)]=ap}},load:function(am,al){return this._mcached[(am+":"+(al===undefined?0:al))]}};var af={FULL:0,CIVIL:1,CIVIL_WJ:2};var D={GENERAL:0,FUN_DEL:1,FUN_OK:2};var ak={UNKNOWN:-1,AUTO_DETECT:0,CIVIL:1,WUJING:2,WUJING_LOCAL:3,ARMY:4,NEW_ENERGY:5,EMBASSY:6,EMBASSY_NEW:7,nameOf:function(al){switch(al){case 1:return"UNKNOWN";case 0:return"AUTO_DETECT";case 1:return"CIVIL";case 2:return"WUJING";case 3:return"WUJING_LOCAL";case 4:return"ARMY";case 5:return"NEW_ENERGY";case 6:return"EMBASSY";case 7:return"EMBASSY_NEW";default:return"UNKNOWN"}},lenOf:function(al){switch(al){case 3:case 5:return 8;default:return 7}}};var x="京津晋冀蒙辽吉黑沪苏浙皖闽赣鲁豫鄂湘粤桂琼渝川贵云藏陕甘青宁新";var ad="QVKHBSLJNGCEZ";var B="ABCDEFGHJKLMNOPRSTUVXY";var ah="1234567890";var ab="QWERTYUPASDFGHJKLZXCVBNM";var ae=ah+ab;var aa="使";var r="港";var g="澳";var t="学";var c="警";var m=t+c+"挂领试超练";var w="W";var G="J";var A="O";var X="DF";var a="123";var U=a+X;var M="QWERTYUIOP";var f="QWERTYUOP";var o="QWERTYUP";var j="ASDFGHJKL";var n="ZXCVBNM";var e=r+g;var T=aa+a;var Y="-";var ai=Y+"+";function s(an,am,al){return{text:an,keyCode:am===undefined?D.GENERAL:am,enabled:al===undefined?true:al,isFunKey:am===undefined?false:(am!==D.GENERAL)}}function k(al,am){return s(al.text,al.keyCode,am)}function l(an){var al=new Array();for(var am=0;am<an.length;am++){al.push(s(an[am]))}return al}function q(al,an,am){return s(an,am,al.enabled)}function J(am,al){return am.indexOf(al)>=0}function W(al){return J(x,al)}function F(al){if(al.length===0){return ak.AUTO_DETECT}else{var am=al.charAt(0);if(J(ad,am)){return ak.ARMY}else{if(aa===am){return ak.EMBASSY}else{if(J(a,am)){return ak.EMBASSY_NEW}else{if(w===am){if(al.length>=3&&W(al.charAt(2))){return ak.WUJING_LOCAL}else{return ak.WUJING}}else{if(W(am)){if(al.length===8){if(/\W[A-Z][0-9DF][0-9A-Z]\d{3}[0-9DF]/.test(al)){return ak.NEW_ENERGY}else{return ak.UNKNOWN}}else{return ak.CIVIL}}else{return ak.UNKNOWN}}}}}}}var u={keyProvider:Q.create({}),layoutProvider:Q.create({}),mixiner:P.create()};var aj="layout.c";var i="layout.w";var b="layout.w.f";var V="layout.f";L.reg({row0:l(x.substr(0,9)),row1:l(x.substr(9,8)),row2:l(x.substr(17,8)),row3:l(x.substr(25,6)+ai),},aj,0);L.reg({row0:l(ah),row1:l(f+g),row2:l(j+r),row3:l(n+ai),},aj,1);L.reg({row0:l(ah),row1:l(o+e),row2:l(j+t),row3:l(n+ai),},aj,[2,3,4,5,6,7]);L.reg({row0:l(x.substr(0,9)),row1:l(x.substr(9,9)),row2:l(x.substr(18,8)),row3:l(x.substr(26,5)+w+ai),},i,0);L.reg({row0:l(ah+x.substr(0,1)),row1:l(x.substr(1,11)),row2:l(x.substr(12,11)),row3:l(x.substr(22,8)+ai),},i,2);L.reg({row0:l(ah+x.substr(0,1)),row1:l(x.substr(1,11)),row2:l(x.substr(12,10)),row3:l(x.substr(22,9)+Y),},b,2);L.reg({row0:l(x.substr(0,10)),row1:l(x.substr(10,10)),row2:l(x.substr(20,10)),row3:l(x.substr(30,1)+T+w+ad.substr(0,4)),row4:l(ad.substr(4,9)+Y)},V,0);L.reg({row0:l(ah),row1:l(M),row2:l(j),row3:l(n+e),row4:l(m+aa+Y)},V,[1,2,3,4,5,6,7]);u.layoutProvider.reg(function(am,al){if(0===al.index&&al.keyboardType===af.CIVIL_WJ){return L.load(i,0)}else{return am.next(al)}});u.layoutProvider.reg(function(am,al){if(2===al.index&&al.keyboardType!==af.CIVIL&&(ak.WUJING===al.numberType||ak.WUJING_LOCAL===al.numberType)){if(al.keyboardType===af.FULL){return L.load(b,2)}else{return L.load(i,2)}}else{return am.next(al)}});u.layoutProvider.reg(function(am,al){if(al.keyboardType===af.FULL){return L.load(V,al.index)}else{return L.load(aj,al.index)}});var ag="keys.any";var v="keys.civil";var I="keys.army";var z="keys.wj";var E="keys.embassy";var K="keys.embassy.zh";var H="keys.num";var y="keys.num.letters";var p="keys.O.police";var N="keys.num.df";var R="keys.hk.macao";var C="keys.postfix";L.reg(l(x+T+w+ad),ag);L.reg(l(ah),H);L.reg(l(ae),y);L.reg(l(ae+c),p);L.reg(l(ab+A),v,1);L.reg(l(B),I,1);L.reg(l(a),E,1);L.reg(l(G),z,1);L.reg(l(ah+x),z,2);L.reg(l(ah+X),N);L.reg(l(e),R);L.reg(l(ae+m),C);L.reg(l(aa),K);u.keyProvider.reg(function(am,al){if(0===al.index){return L.load(ag)}else{return am.next(al)}});u.keyProvider.reg(function(am,al){if(1===al.index){switch(al.numberType){case ak.ARMY:return L.load(I,1);case ak.WUJING:case ak.WUJING_LOCAL:return L.load(z,1);case ak.EMBASSY:return L.load(E,1);case ak.EMBASSY_NEW:return L.load(H);
default:return L.load(v,1)}}else{return am.next(al)}});u.keyProvider.reg(function(am,al){if(2===al.index){switch(al.numberType){case ak.WUJING:case ak.WUJING_LOCAL:return L.load(z,2);case ak.EMBASSY:case ak.EMBASSY_NEW:return L.load(H);case ak.NEW_ENERGY:return L.load(N);default:return L.load(y)}}else{return am.next(al)}});u.keyProvider.reg(function(am,al){if(3===al.index&&ak.EMBASSY===al.numberType){return L.load(H)}else{return am.next(al)}});u.keyProvider.reg(function(am,al){if((4===al.index||5===al.index)&&ak.NEW_ENERGY===al.numberType){return L.load(H)}else{return am.next(al)}});u.keyProvider.reg(function(am,al){if(6===al.index){var ap=al.numberType;switch(al.numberType){case ak.NEW_ENERGY:return L.load(H);case ak.ARMY:case ak.EMBASSY:case ak.WUJING:case ak.WUJING_LOCAL:return L.load(y);case ak.EMBASSY_NEW:return L.load(K);default:var ao=al.number.charAt(1);if("O"===ao){return L.load(p)}else{var an=ak.CIVIL===ap&&"粤"===al.number.charAt(0)&&"Z"===ao;if(an){return L.load(R)}else{return L.load(C)}}}}return am.next(al)});u.keyProvider.reg(function(am,al){if(7===al.index&&ak.NEW_ENERGY===al.numberType){return L.load(N)}return am.next(al)});u.keyProvider.reg(function(){return L.load(y)});function S(an,al){var am=an["row"+al];return am===undefined?[]:am}function ac(am,al,an){am["row"+al]=S(am,al).map(an)}function d(al,am){al.numberType=al.numberType;ac(al,0,am);ac(al,1,am);ac(al,2,am);ac(al,3,am);ac(al,4,am);return al}u.mixiner.reg(function(am,al){var an=al.keys.map(function(ao){return ao.text});return d(am,function(ao){return k(ao,J(an,ao.text))})});u.mixiner.reg(function(am,al){return d(am,function(an){var ao=an.enabled;if(ao&&al.index===0&&am.numberType===ak.NEW_ENERGY){ao=W(an.text)}return k(an,ao)})});u.mixiner.reg(function(al){return d(al,function(am){if("-"===am.text){return q(am,"删除",D.FUN_DEL)}else{if("+"===am.text){return q(am,"确定",D.FUN_OK)}else{return am}}})});u.mixiner.reg(function(al){return d(al,function(am){if(am.keyCode===D.FUN_DEL){return k(am,al.numberLength!=0)}else{return am}})});u.mixiner.reg(function(al){return d(al,function(am){if(am.keyCode===D.FUN_OK){return k(am,al.numberLength===al.numberLimitLength)}else{return am}})});u.mixiner.reg(function(al){al.keys=S(al,0).concat(S(al,1)).concat(S(al,2)).concat(S(al,3)).concat(S(al,4));return al});function O(al){var am=al.constructor();for(var an in al){if(al.hasOwnProperty(an)){am[an]=al[an]}}return am}function Z(aq,av,au,an){if(aq===undefined||aq<af.FULL||aq>af.CIVIL_WJ){throw new RangeError("参数(keyboardType)范围必须在[0, 2]之间，当前: "+aq)}if(av===undefined||av!==parseInt(av,10)){throw new TypeError("参数(inputIndex)必须为整数数值")}if(au===undefined||typeof au!=="string"){throw new TypeError("参数(presetNumber)必须为字符串")}if(an===undefined||an!==parseInt(an,10)){throw new TypeError("参数(numberType)必须为整数数值")}var am=F(au);var ap=an;if(au.length>0&&an===ak.AUTO_DETECT){ap=am}var ao=ak.lenOf(ap);var at=au.length;av=Math.min(av,ao-1);if(at>ao){throw new RangeError("参数(presetNumber)字符太长："+au+"，车牌类型："+an+"，此类型最大长度:"+ao)}var ar={index:av,number:au,keyboardType:aq,numberType:ap,};var al=O(u.layoutProvider.process(ar));al.index=ar.index;al.presetNumber=ar.number;al.keyboardType=ar.keyboardType;al.numberType=ar.numberType;al.presetNumberType=ar.numberType;al.detectedNumberType=am;al.numberLength=at;al.numberLimitLength=ao;ar.keys=u.keyProvider.process(ar);return u.mixiner.process(al,ar)}var h=function(){this.update=Z;this.config=u};h.$newKey=s;h.NUM_TYPES=ak;h.KEY_TYPES=D;h.KEYBOARD_TYPES=af;h.VERSION="V2.0/2017.11S01/iRain(SZ)";return h})));